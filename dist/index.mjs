var i=class extends Error{constructor(e,t){super(e);this.message=e;this.higherOrderError=t;Object.setPrototypeOf(this,new.target.prototype)}},n=class extends i{constructor(e,t,o=void 0){super(e,o);this.message=e;this.input=t;this.higherOrderError=o}};import{Readable as c}from"stream";var p=class{openStream(r){try{let e=c.from(r);if(e.errored)throw e.errored;return e}catch(e){throw new n("Could not open buffer for read stream",r,e)}}};import{createReadStream as I}from"fs";var m=class{openStream(r){try{let e=I(r);if(e.errored)throw e.errored;return e}catch(e){throw new n("Could not open read stream to the file",r,e)}}};import h from"got";var s=class{openStream(r){try{let e=h.stream(r);if(e.errored)throw e.errored;return e}catch(e){throw new n("Could not open read stream from HTTP address",r,e)}}};var f=class{openStream(r){try{return r}catch(e){throw new n("Could not open read stream to the file",r,e)}}};import{Stream as w}from"stream";var d=class{static createInputHandler(r){return r instanceof w?new f:Buffer.isBuffer(r)?new p:typeof r=="string"&&r.toLowerCase().startsWith("http")||r instanceof URL?new s:new m}};var l=class a{lib;libConstructor;constructor(r){this.libConstructor=r}async instantiateLib(){try{this.lib=await this.libConstructor({})}catch(r){throw new i("Failed to instantiate MediaInfoLib",r)}}async getInfo(r){this.lib||await this.instantiateLib();try{return await new Promise((e,t)=>{let o=a.normalizeInput(r);a.getDataStream(o,t).then(u=>this.getMediaInfoData(u)).then(e).catch(t)})}catch(e){throw new i("Failed to read media data",e)}}static normalizeInput(r){let e;return r instanceof URL?e=r.toString():e=r,e}static async getDataStream(r,e){let o=d.createInputHandler(r).openStream(r);return o.on("error",e),o}getMediaInfoData(r){return new Promise(async e=>{let t=new this.lib.MediaInfo;t.Open_Buffer_Init(-1,0),r.on("data",o=>{t.Open_Buffer_Continue(o),t.Open_Buffer_Continue_Goto_Get()}),r.on("end",()=>{t.Open_Buffer_Finalize(),t.Option("Output","JSON"),t.Option("Complete");let o=JSON.parse(t.Inform());t.Close(),t.delete(),e(o)})})}};export{l as MediaInfo};
